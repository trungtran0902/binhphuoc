<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="../logo.png" type="image/png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô Hình Đoàn ca múa nhạc tỉnh Bình Phước</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #titleBar {
            background-color: #FFCC99;
            color: black;
            text-align: center;
            padding: 5px;
            font-size: 15px;
        }

        #mainContent {
            display: flex;
            flex: 1;
        }

        #rightColumn {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #zoomButton {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background-color: #008CBA;
            color: white;
            border: none;
            cursor: pointer;
        }

        #pauseButton {
            position: absolute;
            top: 50px; /* Đặt vị trí dưới nút zoom */
            right: 10px;
            padding: 10px 20px;
            background-color: #f44336;
            color: white;
            border: none;
            cursor: pointer;
        }

        #noteBox {
            position: absolute;
            top: 90px; /* Đặt vị trí dưới nút Pause */
            right: 10px;
            padding: 10px;
            background-color: #FFFF99;
            border: 1px solid #ccc;
            z-index: 1000;
            max-width: 300px;
            overflow: auto;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="titleBar">
        <h2>Đoàn ca múa nhạc tỉnh Bình Phước</h2>
        <p>GVMP+998, Tân Phú, Đồng Xoài, Bình Phước</p>
    </div>
    <div id="mainContent">
        <div id="rightColumn">
            <button id="zoomButton">Điều hướng</button>
            <button id="pauseButton">Tạm dừng xoay</button>
            <div id="noteBox">
                <h2>Ghi Chú</h2>
                <p>Giữ chuột phải để xoay</p>
                <p>Giữ chuột trái để di chuyển</p>
                <p>Lăn chuột để zoom in/zoom out</p>
            </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
            <script>
                // Tạo scene, camera và renderer
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                document.getElementById('rightColumn').appendChild(renderer.domElement);

                function resizeRenderer() {
                    renderer.setSize(window.innerWidth - 300, window.innerHeight - 50); // Adjust size to fit container
                }

                window.addEventListener('resize', resizeRenderer);
                resizeRenderer(); // Initial call to set renderer size

                renderer.setClearColor(0xffffff); // Đặt nền màu trắng

                // Thêm điều khiển camera
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enablePan = true; // Bật tính năng di chuyển
                controls.enableRotate = true; // Bật tính năng xoay
                controls.mouseButtons = {
                    LEFT: THREE.MOUSE.PAN,    // Chuột trái di chuyển camera
                    RIGHT: THREE.MOUSE.ROTATE // Chuột phải xoay camera
                };

                // Thêm ánh sáng
                const light = new THREE.HemisphereLight(0xffffbb, 0x080820, 1.8);
                scene.add(light);

                let object;
                let rotationSpeed = 0.002; // Giảm tốc độ xoay
                let isRotating = true; // Biến theo dõi trạng thái xoay

                // Tải file GLB
                const loader = new THREE.GLTFLoader();
                loader.load('DoancamuanhactinhBinhPhuoc_cinema.glb', function (gltf) {
                    object = gltf.scene;
                    scene.add(object);

                    // Zoom to layer ngay khi tải xong mô hình
                    zoomToLayer(object);

                    renderer.render(scene, camera);
                }, undefined, function (error) {
                    console.error(error);
                });

                // Hàm zoom to layer
                function zoomToLayer(object) {
                    const box = new THREE.Box3().setFromObject(object);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());

                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = camera.fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));

                    cameraZ *= 1.5; // Thêm khoảng cách giữa đối tượng và camera
                    camera.position.z = cameraZ;

                    const minZ = box.min.z;
                    const cameraToFarEdge = minZ < 0 ? -minZ + cameraZ : cameraZ - minZ;

                    camera.far = cameraToFarEdge * 3;
                    camera.updateProjectionMatrix();

                    camera.lookAt(center);

                    controls.target.copy(center);
                    controls.update();

                    render();
                }

                // Thêm sự kiện cho nút zoom
                document.getElementById('zoomButton').addEventListener('click', function () {
                    if (object) {
                        zoomToLayer(object);
                    }
                });

                // Thêm sự kiện cho nút pause
                document.getElementById('pauseButton').addEventListener('click', function () {
                    isRotating = !isRotating; // Chuyển đổi trạng thái xoay
                    this.textContent = isRotating ? 'Tạm dừng xoay' : 'Tiếp tục xoay'; // Cập nhật nội dung nút
                });

                // Hàm render
                function render() {
                    renderer.render(scene, camera);
                }

                // Hàm animate để render mô hình liên tục và xoay mô hình
                function animate() {
                    requestAnimationFrame(animate);
                    if (object && isRotating) {
                        object.rotation.y += rotationSpeed; // Xoay mô hình quanh trục y
                    }
                    controls.update();
                    render();
                }
                animate();
            </script>
        </div>
    </div>
</body>
</html>
